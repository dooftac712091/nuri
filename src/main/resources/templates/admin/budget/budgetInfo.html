<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/admin/layout/default}">

	<th:block layout:fragment="customJs">
		<script th:src="@{/js/jquery-3.7.1.js}"></script>
	</th:block>

	<th:block layout:fragment="customJsCode">
		<script>
			$(function() {
				//유효성 검사
				function validationCheck(data) {
					let isValid = true;
					if (typeof data == "object") {
						$.each(budget, function (key, value) {
							if (value == null || value == '' || typeof value == 'undefined') {
								isValid = false;
								let elementId = $(`label[for="${key}"]`).text();
								alert(`${elementId} <-- 필수 입력 항목입니다.`);
								$(`input[id="${key}"]`).focus();
								console.log("유효성 검사 : "+isValid);
								return isValid;
							}
						});
					} else {
						if (data == null || data == '' || typeof data == 'undefined') {
							isValid = false;
							let $elementId = $(`label[for="searchYear"]`).text();
							alert(`${$elementId} <-- 필수 입력 항목입니다.`);
							console.log("유효성 검사 : " + isValid);
							return isValid;
						}
					}
					return isValid;
				}

				//검색 버튼 클릭 시 입력한 연도의 데이터 가져오기
				$('#budgetSearchBtn').click(function(){
					let $searchYear = $("#searchYear").val();
					console.log($searchYear);
					let isValid = validationCheck($searchYear);
					console.log(isValid);
					if(isValid){
						//유효성 검사를 통과한 경우 selelct문 실행
						console.log($searchYear);
						$("#budgetSearchForm").submit();
					}
				});

				//전체 체크 + 전체 체크 해제
				// $('#check-all').click(function(){
				// 	if($('#check-all').prop("checked")){
				// 		//전체 체크
				// 		$("input[name='checkEle']").prop("checked", true);
				// 	}else{
				// 		//전체 체크 해제
				// 		$("input[name='checkEle']").prop("checked", false);
				// 	}
				// })

				//체크한 항목의 수정 페이지로 이동(한 개만 체크 가능)
				$('#budgetUpdate').click(function () {
					//allCheck 말고 리스트 각 행의 checkbox 행에 name="checkEle" 추가함

					//체크된 값의 개수 카운팅
					let count = $("input[name='checkEle']:checked").length;
					console.log("체크된 행의 수 : " + count);

					if(count === 0){
						//체크된 값 없이 버튼만 누른 경우 수정 불가
						alert("수정할 행을 선택해주세요");
					}else if(count > 1){
						//여러 개 체크된 경우 수정 불가
						alert("수정할 한 개의 행만 선택해주세요");
					}else{
						//한 개의 행만 체크된 경우 해당 행의 연도를 수정 Form으로 전달
						alert("대충 수정페이지로 이동한다는 내용");
						//체크된 행의 연도 값 가져오기
						let selectedEle = $("tr[class='selected']").children("td[class='applyYear']").val();
						console.log(selectedEle);

						//페이지 이동
						//@{/admin/budget/budgetUpdate(applyYear=${applyYear})}

					}




				});

				//체크한 항목 삭제(여러 행 한 번에 삭제)
				$('#budgetDelete').click(function () {
					//체크된 값의 개수 카운팅
					let count = $("input[name='checkEle']:checked").length;
					console.log("체크된 행의 수 : " + count);
					if(count == 0){
						alert("삭제할 행을 선택해주세요");
					}else{
						alert("삭제(곧 만들 예정)");
					}

				});

			});
		</script>
	</th:block>
	
  <body id="page-top">

	<!-- /* layout:decorate 이 부분의 파일에서 사용자 정의로 선언한 조각에 작성한 html코드를 삽입 */ -->
	<th:block layout:fragment="customContents">
		<div class="" role="main">

			<div class="clearfix"></div>
  
   			<div class="col-md-12 col-sm-12 col-xs-12">
     			<div class="x_panel">
       				<div class="x_title">
         				<h2>검색 조건</h2>
	                      <a class="collapse-link navbar-right"><i class="fa fa-chevron-up"></i></a>
         				<div class="clearfix"></div>
       				</div>
	       			<div class="x_content">
						<br />
						
                    	<form id="budgetSearchForm" data-parsley-validate class="form-horizontal form-label-left">
	                        <div class="form-group">
	                        	<label for="searchYear" class="control-label col-md-3 col-sm-3 col-xs-12"> 연도 </label>
	                        	<div class="col-md-6 col-sm-6 col-xs-12">
	                         	 <input type="number" id="searchYear" name="searchYear" class="form-control col-md-7 col-xs-12"
								 min="2011" max="2999">
	                        	</div>
	                      	</div>

		                      <div class="ln_solid"></div>
		                      <div class="form-group">
		                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3" >
		                          <button type="reset" class="btn btn-primary">초기화</button>
		                          <button type="button" id="budgetSearchBtn" class="btn btn-success">검색</button>
		                        </div>
		                      </div>
                    	</form>
			        </div>
			     </div>
			    </div>
			     
			     <div class="clearfix"></div>
			     
			     <div class="col-md-12 col-sm-12 col-xs-12">
		   			<div class="x_panel">
		       			<div class="x_title">
			       			<h2>검색 결과</h2>
		                      <a class="collapse-link navbar-right"><i class="fa fa-chevron-up"></i></a>
	         				<div class="clearfix"></div>
	         			</div>
	                  <div class="x_content">
		         			<table id="datatable-checkbox" class="table table-striped table-bordered bulk_action">
					           <thead>
					             <tr>
					               <th><input type="checkbox" id="check-all" class="flat"></th>
				                   <th>연도</th>
				                   <th>예산</th>
				                   <th>1인당 지원 금액</th>
									<th>등록자</th>
									<th>등록일자</th>
									<th>수정일자</th>
					             </tr>
					           </thead>
		
		               		   <tbody>
							   	 <tr th:if="${budgetTotalList==null}">
									 <td colspan="7">등록된 예산 목록이 없습니다</td>
								 </tr>
				                 <tr th:unless="${budgetTotalList==null}" th:each="l:${budgetTotalList}">
				                   <td><input type="checkbox" class="flat" name="checkEle"></td>
									 <td class="applyYear" th:text="${l.applyYear}"></td>
									 <td th:text="${l.budgetTotalAmount}"></td>
									 <td th:text="${l.budgetByPerson}"></td>
									 <td th:text="${l.officerId}"></td>
									 <td th:text="${l.registDT}"></td>
									 <td th:text="${l.updateDT}"></td>
				                 </tr>
		                 		</tbody>
		             		</table>

							<div class="ln_solid"></div>
	                      	<div class="form-group">
		                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3" >
									<button type="button" id="budgetUpdate" class="btn btn-primary">수정</button>
		                            <button type="button" id="budgetDelete" class="btn btn-success">삭제</button>
		                        </div>
	                      	</div>
		           		</div>
	       			</div>
				</div>
			</div>
		</div>
	</th:block>
  </body>
</html>
