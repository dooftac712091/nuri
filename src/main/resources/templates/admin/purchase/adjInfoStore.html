<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{admin/layout/default}">

	<th:block layout:fragment="customJs">
		<script th:src="@{/admin/js/jquery-3.7.1.js}"></script>
	</th:block>
	
	<th:block layout:fragment="customJsCode">
		<script>

			//각 행마다의 금액이 들어있는 배열 만들기
			const totalAmount = [];
			$.each($("td.adjTotalAmount"), function (idx, obj){
				totalAmount.push(Number($(obj).text()));
			});
			let amount = 0
			for(let elem of totalAmount){
				amount += elem;
			}
			//테이블 오른쪽 아래 총합 정산금액에 입력
			$("#totalAmount").text(amount);


			//사용자가 항목선택의 값을 바꿀 때마다 활성화되는 입력 창이 다름
			$("#searchKey").change(function () {
				let $searchKey = $("#searchKey").val();

				console.log("선택한 옵션 : "+$searchKey);
				switch($searchKey){
					case 'region':
						$("#regionCode").prop("disabled", false);
						$("#districtCode").prop("disabled", false);
						$("#categoryCode").prop("disabled", true);
						$("#categoryCode").val('');
						$("#storeId").prop("disabled", true);
						$("#storeId").val('');
						break;
					case 'category':
						$("#regionCode").prop("disabled", true);
						$("#regionCode").val('');
						$("#districtCode").prop("disabled", true);
						$("#districtCode").val('');
						$("#categoryCode").prop("disabled", false);
						$("#store").prop("disabled", true);
						$("#storeId").val('');
						break;
					case 'regionCategory':
						$("#regionCode").prop("disabled", false);
						$("#districtCode").prop("disabled", false);
						$("#categoryCode").prop("disabled", false);
						$("#store").prop("disabled", true);
						$("#storeId").val('');
						break;
					case 'store':
						$("#regionCode").prop("disabled", true);
						$("#regionCode").val('');
						$("#districtCode").prop("disabled", true);
						$("#districtCode").val('');
						$("#categoryCode").prop("disabled", true);
						$("#categoryCode").val('');
						$("#storeId").prop("disabled", false);
						break;
					default:
						console.log("선택X");
						alert("검색 항목을 선택한 후 값을 입력해주세요");
						break;
				}

			})

			$("#searchBtn").click(function () {
				//1. 검색 버튼을 눌렀을 때 입력된 값 유효성 검사(입력이 활성화 됐을 때만)
				$adjSearchForm = $("#adjSearchForm");
				console.log($adjSearchForm);

				//2.

			})

		</script>
	</th:block>
	
  <body id="page-top">

	<!-- /* layout:decorate 이 부분의 파일에서 사용자 정의로 선언한 조각에 작성한 html코드를 삽입 */ -->
	<th:block layout:fragment="customContents">
	
		
		<div class="" role="main">

			<div class="clearfix"></div>
  
   			<div class="col-md-12 col-sm-12 col-xs-12">
     			<div class="x_panel">
       				<div class="x_title">
         				<h2>검색 조건</h2>
	                      <a class="collapse-link navbar-right"><i class="fa fa-chevron-up"></i></a>
         				<div class="clearfix"></div>
       				</div>
	       			<div class="x_content">
						<br />
                    	<form id="adjSearchForm" data-parsley-validate class="form-horizontal form-label-left">
							<div class="form-group">
								<label class="control-label col-md-3 col-sm-3 col-xs-12"> 항목 선택 </label>
								<div class="col-md-6 col-sm-6 col-xs-12">
									<select id="searchKey" name="searchKey" class="form-control">
										<option value="">==========선택==========</option>
										<option value="region">지역</option>
										<option value="category">업종</option>
										<option value="regionCategory">지역 + 업종</option>
										<option value="store">가맹점</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label for="regionCode" class="control-label col-md-3 col-sm-3 col-xs-12"> 지역</label>
								<div class="col-md-6 col-sm-6 col-xs-12">
									<select id="regionCode" name="regionCode" class="form-control" disabled="disabled">
										<option value="">==========지역을 선택하세요==========</option>
										<th:block th:unless="${regionList == null}" th:each="r:${regionList}">
											<option th:value="${r.regionCode}" th:text="${r.regionName}"></option>
										</th:block>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label for="districtCode" class="control-label col-md-3 col-sm-3 col-xs-12"> 지역 상세</label>
								<div class="col-md-6 col-sm-6 col-xs-12">
									<select id="districtCode" name="districtCode" class="form-control" disabled="disabled">
										<option value="">==========지역 상세를 선택하세요==========</option>
										<option value="00">전체</option>
										<th:block th:unless="${districtList == null}" th:each="d:${districtList}">
											<option th:value="${d.districtCode}" th:text="${d.districtName}"></option>
										</th:block>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label for="categoryCode" class="control-label col-md-3 col-sm-3 col-xs-12"> 업종</label>
								<div class="col-md-6 col-sm-6 col-xs-12">
									<select id="categoryCode" name="categoryCode" class="form-control" disabled="disabled">
										<option value="">==========업종을 선택하세요==========</option>
										<th:block th:unless="${storeList == null}" th:each="s:${storeList}">
											<option th:value="${s.storeCategoryCode}" th:text="${s.storeCategoryName}"></option>
										</th:block>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label for="storeId" class="control-label col-md-3 col-sm-3 col-xs-12"> 가맹점명</label>
								<div class="col-md-6 col-sm-6 col-xs-12">
								  <input type="text" id="storeId" class="form-control col-md-7 col-xs-12" disabled="disabled">
								</div>
							</div>
	                      
	                      <div class="form-group">
	                        <label class="control-label col-md-3 col-sm-3 col-xs-12 ">검색 기간</label>
	                        <div class="data-area col-md-6 col-sm-6 col-xs-12" style="justify-content: center; display: flex;">
								<input type="date" name="startDate" id="startDate" class="form-control" style="width: 250px;"> ~
								<input type="date" name="endDate" id="endDate" class="form-control" style="width: 250px;">
	                        </div>
	                      </div>
	                      
	                      <div class="ln_solid"></div>
	                      <div class="form-group">
	                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3" >
	                          <button type="reset" class="btn btn-primary" id="resetBtn">초기화</button>
	                          <button type="button" class="btn btn-success" id="searchBtn">검색</button>
	                        </div>
	                      </div>
                    	</form>
			        </div>
			     </div>
			     
			     <div class="clearfix"></div>

				<div class="x_panel">
					<div class="x_title">
						<h2>검색 결과</h2>
						  <a class="collapse-link navbar-right"><i class="fa fa-chevron-up"></i></a>
						<div class="clearfix"></div>
					</div>
				  <div class="x_content">
						<table id="datatable-checkbox" class="table table-striped table-bordered bulk_action">
						   <thead>
							 <tr>
								 <th>정산코드</th>
								 <th>가맹점명</th>
								 <th>지역</th>
								 <th>업종</th>
								 <th>정산 금액</th>
								 <th>정산 일자</th>
							 </tr>
						   </thead>

						   <tbody>
						   	 <tr th:if="${dayAdjustmentList == null}">
								 <td colspan="6">등록된 정산 정보가 없습니다.</td>
							 </tr>
							 <tr th:unless="${dayAdjustmentList == null}" th:each="l:${dayAdjustmentList}">
								 <td th:text="${l.dateAdjustmentNum}"></td>
							   	 <td th:text="${l.storeName}"></td>
								 <td th:text="${l.regionName}+' '+${l.districtName}"></td>
								 <td th:text="${l.storeCategoryName}"></td>
								 <td class="adjTotalAmount" th:text="${l.dateTotalSales}"></td>
							     <td th:text="${l.amountDate}"></td>
							 </tr>
							</tbody>
						</table>
						<div class="pull-right">
							<h5>총 정산 금액 : <b id="totalAmount"></b>원</h5>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="/admin/js/customjs/district-list.js"></script>
	</th:block>
  </body>
</html>
