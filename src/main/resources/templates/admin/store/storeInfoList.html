<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/admin/layout/default}">

<th:block layout:fragment="customJs">
  <script th:src="@{/js/jquery-3.7.1.js}"></script>
</th:block>

<body>

<!-- /* layout:decorate 이 부분의 파일에서 사용자 정의로 선언한 조각에 작성한 html코드를 삽입 */ -->
<th:block layout:fragment="customContents">

  <div class="page-title">
    <div class="title_left">
      <h3>Form Elements</h3>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel">
        <div class="tile_count">
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-user"></i> Total Users</span>
            <div class="count">2500</div>
            <span class="count_bottom"><i class="green">4% </i> From last Week</span>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-clock-o"></i> Average Time</span>
            <div class="count">123.50</div>
            <span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>3% </i> From last Week</span>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-user"></i> Total Males</span>
            <div class="count green">2,500</div>
            <span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-user"></i> Total Females</span>
            <div class="count">4,567</div>
            <span class="count_bottom"><i class="red"><i class="fa fa-sort-desc"></i>12% </i> From last Week</span>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-user"></i> Total Collections</span>
            <div class="count">2,315</div>
            <span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-4  tile_stats_count">
            <span class="count_top"><i class="fa fa-user"></i> Total Connections</span>
            <div class="count">7,325</div>
            <span class="count_bottom"><i class="green"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="clearfix"></div>
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel">
        <div class="x_title">
          <h2>가맹점 조회 <small>누리컬쳐에 등록된 가맹점 정보 </small></h2>
          <div class="clearfix"></div>
        </div>
        <div class="x_content">
          <br />
          <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left">
            <div class="form-group">
              <label for="searchKey" class="control-label col-md-3 col-sm-3 col-xs-12">항목</label>
              <div class="col-md-6 col-sm-6 col-xs-12">
                <select id="searchKey" class="form-control" name="searchKey" required>
                  <option value="storeId">가맹점 아이디</option>
                  <option value="storeName">가맹점명</option>
                  <option value="userName">가맹점 회원명</option>
                  <option value="storeCategoryName">가맹점 분류</option>
                  <option value="storeAddress">가맹점 주소</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="searchValue" class="control-label col-md-3 col-sm-3 col-xs-12">내용</label>
              <div class="col-md-6 col-sm-6 col-xs-12">
                <input id="searchValue" class="form-control col-md-7 col-xs-12" type="text" name="searchValue">
              </div>
            </div>
            <div class="ln_solid"></div>
            <div class="form-group">
              <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                <button class="btn btn-primary" type="button">취소</button>
                <button class="btn btn-primary" type="reset">초기화</button>
                <button id="searchBtn" type="button" class="btn btn-success">검색</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- List 형태의 경우, button을 사용해서 보여질 List를 표시할 수 있다. -->
  <!-- UserList의 검색창을 통해서 회원의 지역, 생년월일, 아이디, 전화번호를 알 수 있다.-->
  <!-- Ajax 통신을 통해 오른쪽에 검색할 조건을 선택할 수 있는 지역 select 옵션으로 지정
  특정할 수 있는 정보인 이름, 전화번호, 가입일을 검색할 수 있게한다.-->


  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel">
        <div class="x_content">
          <p class="text-muted font-13 m-b-30">
            키워드로 검색한 결과</p>
          <table id="datatable-checkbox" class="table table-striped table-bordered bulk_action">
            <thead>
            <tr>
              <th>선택</th>
              <th>가맹점 아이디</th>
              <th>가맹점명</th>
              <th>가맹점 회원명</th>
              <th>가맹점 분류</th>
              <th>가맹점 이메일</th>
              <th>가맹점 연락처</th>
              <th>가맹점 주소</th>
              <th>가맹점 등록일</th>
              <th>영업시간</th>
            </tr>
            </thead>

            <tbody id="searchListTable">
            <tr th:each="list : ${storeListForAdmin}">
              <td>
                <input type="checkbox" value="${element.storeId}" name="chkb">
              </td>
              <td><a th:href="@{/admin/store/storeInfoUpdate(storeId=${list.storeId})}" th:text="${list.storeId}"></a></td>
              <td th:text="${list.storeName}"></td>
              <td th:text="${list.userName}"></td>
              <td th:text="${list.storeCategoryName}"></td>
              <td th:text="${list.userEmail}"></td>
              <td th:text="${list.storeContact}"></td>
              <td th:text="${list.storeAddress}"></td>
              <td th:text="${list.storeRegDate}"></td>
              <td th:text="${list.openingTime}"></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <script>

    const $searchBtn = document.querySelector('#searchBtn');
    const $searchKey = document.querySelector('#searchKey');
    const $searchValue = document.querySelector('#searchValue');
    const searchListUrl = 'http://localhost/admin/store/storeSearchList';
    let key = "";
    let value = "";

    let $searchListTable = document.querySelector('#searchListTable');

    $searchBtn.addEventListener('click', () => {
      $searchListTable.replaceChildren();
      key = $searchKey.value;
      let value = $searchValue.value;
      search(key, value)
    })

    function search (key, value) {
      console.log(key, value);
      fetch(searchListUrl, {
        method : "POST",
        headers : {
          "Content-Type" : "application/json"
        },
        body : JSON.stringify({
          searchKey : key,
          searchValue : value
        })
      })
              .then((response) => response.json())
              .then((result) => result.forEach((element) => {

                const resultRow = document.createElement('tr');
                const chkBox = document.createElement('input');
                const chkTd = document.createElement('td');
                chkBox.setAttribute("type", "checkbox");
                chkBox.setAttribute("name", "chkb");
                chkBox.setAttribute("value", `${element.userId} `);
                chkTd.appendChild(chkBox);
                const storeIdTd = document.createElement('td');
                const storeUpdateAnchor = document.createElement('a');
                storeUpdateAnchor.setAttribute("href", `http://localhost/admin/store/storeInfoUpdate?storeId=${element.storeId}`);
                storeUpdateAnchor.appendChild(document.createTextNode(`${element.storeId}`));
                storeIdTd.appendChild(storeUpdateAnchor);
                const storeNameTd = document.createElement('td');
                storeNameTd.appendChild(document.createTextNode(`${element.storeName}`));
                const userNameTd = document.createElement('td');
                userNameTd.appendChild(document.createTextNode(`${element.userName}`));
                const storeCategoryTd = document.createElement('td');
                storeCategoryTd.appendChild(document.createTextNode(`${element.storeCategoryName}`));
                const userEmailTd = document.createElement('td');
                userEmailTd.appendChild(document.createTextNode(`${element.userEmail}`));
                const userContactTd = document.createElement('td');
                userContactTd.appendChild(document.createTextNode(`${element.storeContact}`));
                const userAddressTd = document.createElement('td');
                userAddressTd.appendChild(document.createTextNode(`${element.storeAddress}`));
                const storeRegDateTd = document.createElement('td');
                storeRegDateTd.appendChild(document.createTextNode(`${element.storeRegDate}`));
                const openingTimeTd = document.createElement('td');
                openingTimeTd.appendChild(document.createTextNode(`${element.openingTime}`));
                resultRow.appendChild(chkTd);
                resultRow.appendChild(storeIdTd);
                resultRow.appendChild(storeNameTd);
                resultRow.appendChild(userNameTd);
                resultRow.appendChild(storeCategoryTd);
                resultRow.appendChild(storeCategoryTd);
                resultRow.appendChild(userEmailTd);
                resultRow.appendChild(userContactTd);
                resultRow.appendChild(userAddressTd);
                resultRow.appendChild(storeRegDateTd);
                resultRow.appendChild(openingTimeTd);
                $searchListTable.appendChild(resultRow);
              }))
    }



  </script>

</th:block>

</body>

</html>
